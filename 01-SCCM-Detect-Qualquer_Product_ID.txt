param(
    [Parameter(Mandatory = $true)]
    [string]$ProductName
)

# Exemplo de uso no SCCM:
# -ProductName "chrome"
# -ProductName "solarw"
# -ProductName "nessus"

function Get-InstalledApp {
    param(
        [Parameter(Mandatory = $true)]
        [string]$NamePattern
    )

    $paths = @(
        "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall",
        "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall"
    )

    $results = @()

    foreach ($path in $paths) {
        if (Test-Path $path) {
            Get-ChildItem $path | ForEach-Object {
                try {
                    $props = Get-ItemProperty $_.PsPath -ErrorAction Stop
                }
                catch {
                    return
                }

                if ($null -ne $props.DisplayName -and $props.DisplayName -like "*$NamePattern*") {
                    $results += [PSCustomObject]@{
                        ComputerName    = $env:COMPUTERNAME
                        DisplayName     = $props.DisplayName
                        DisplayVersion  = $props.DisplayVersion
                        Publisher       = $props.Publisher
                        InstallLocation = $props.InstallLocation
                        # Para MSI, essa chave normalmente é o ProductCode (GUID)
                        ProductCode     = $_.PSChildName
                        UninstallString = $props.UninstallString
                        RegistryKey     = $_.PsPath
                    }
                }
            }
        }
    }

    return $results
}

Write-Output "Procurando por produtos que contenham: '$ProductName' ..."

$appList = Get-InstalledApp -NamePattern $ProductName

if (-not $appList -or $appList.Count -eq 0) {
    Write-Output "Nenhum produto encontrado contendo '$ProductName'."
    exit 1
}

# Saída principal (fica bonitinha no resultado do Run Script)
$appList | Select-Object ComputerName, DisplayName, DisplayVersion, ProductCode, UninstallString
