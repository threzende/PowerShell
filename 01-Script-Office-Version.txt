$filesToCheck = @(
    @{
        Name            = "wpft632.cnv"
        Path            = "C:\Program Files (x86)\Common Files\Microsoft Shared\TextConv\wpft632.cnv"
        ExpectedVersion = ""
    },
    @{
        Name            = "osfproxy.dll"
        Path            = "C:\Program Files (x86)\Microsoft Office\Office16\osfproxy.dll"
        ExpectedVersion = ""
    },
    @{
        Name            = "epsomp32.flt"
        Path            = "C:\Program Files (x86)\Common Files\Microsoft Shared\GRPHFLT\epsomp32.flt"
        ExpectedVersion = ""
    },
    @{
        Name            = "osf.dll"
        Path            = "C:\Program Files (x86)\Microsoft Office\Office16\osf.dll"
        ExpectedVersion = ""
    },
    @{
        Name            = "ose.exe"
        Path            = "C:\Program Files (x86)\Common Files\Microsoft Shared\Source Engine\ose.exe"
        ExpectedVersion = ""
    },
    @{
        Name            = "osetup.dll"
        Path            = "C:\Program Files (x86)\Common Files\Microsoft Shared\OFFICE16\Office Setup Controller\osetup.dll"
        ExpectedVersion = ""
    },
    @{
        Name            = "epsimp32.flt"
        Path            = "C:\Program Files (x86)\Common Files\Microsoft Shared\GRPHFLT\epsimp32.flt"
        ExpectedVersion = ""
    }
)

$results = foreach ($item in $filesToCheck) {
    $exists         = Test-Path $item.Path
    $currentVersion = $null
    $status         = "FileNotFound"

    if ($exists) {
        try {
            $currentVersion = (Get-Item $item.Path).VersionInfo.FileVersion

            if ([string]::IsNullOrWhiteSpace($item.ExpectedVersion)) {
                $status = "Found"
            }
            else {
                if ([version]$currentVersion -ge [version]$item.ExpectedVersion) {
                    $status = "OK (>= expected)"
                }
                else {
                    $status = "Outdated (< expected)"
                }
            }
        }
        catch {
            $status = "Error: $($_.Exception.Message)"
        }
    }

    [PSCustomObject]@{
        ComputerName    = $env:COMPUTERNAME
        FileName        = $item.Name
        Path            = $item.Path
        CurrentVersion  = $currentVersion
        ExpectedVersion = $item.ExpectedVersion
        Status          = $status
    }
}

$results | Format-Table -AutoSize

$folderPath = "C:\Temp\OfficeFilesVersion"
if (-not (Test-Path $folderPath)) {
    New-Item -Path $folderPath -ItemType Directory -Force | Out-Null
}

$fileName = "{0}_OfficeFilesVersion.csv" -f $env:COMPUTERNAME
$filePath = Join-Path $folderPath $fileName

$results | Export-Csv -Path $filePath -NoTypeInformation -Encoding UTF8
