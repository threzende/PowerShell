# Import the ScheduledTasks module (required for task creation)
Import-Module ScheduledTasks

# Define the task action: run PowerShell to update Microsoft Defender signatures
$Action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-Command `"Update-MpSignature`""

# Create two daily triggers: one at 9 AM and another at 5 PM
$Trigger1 = New-ScheduledTaskTrigger -Daily -At 9am
$Trigger2 = New-ScheduledTaskTrigger -Daily -At 5pm

# Set the task to run as SYSTEM with highest privileges
$Principal = New-ScheduledTaskPrincipal -UserId "NT AUTHORITY\SYSTEM" -LogonType ServiceAccount -RunLevel Highest

# Configure task settings: allow on battery, don't stop on battery, start when available
$Settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries -StartWhenAvailable

# Register the task with the name "DefenderSignatureUpdate"
Register-ScheduledTask -TaskName "DefenderSignatureUpdate" -Action $Action -Trigger $Trigger1, $Trigger2 -Principal $Principal -Settings $Settings

# Output success message
Write-Host "âœ… Task 'DefenderSignatureUpdate' created successfully!"
