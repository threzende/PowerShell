# --- Simple test: download and install Defender offline update (mpam-fe.exe) ---

$ErrorActionPreference = 'Stop'
try { [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 } catch {}

# Pick correct package by OS architecture
$arch = if ([Environment]::Is64BitOperatingSystem) { 'x64' } else { 'x86' }
$uri  = "https://go.microsoft.com/fwlink/?LinkID=121721&arch=$arch"
$dst  = Join-Path $env:TEMP "mpam-fe_$arch.exe"

Write-Host "Downloading: $uri"
Invoke-WebRequest -Uri $uri -OutFile $dst -UseBasicParsing

Write-Host "Installing package silently..."
$proc = Start-Process -FilePath $dst -ArgumentList "/Q" -PassThru -Wait -WindowStyle Hidden
Write-Host "Installer exit code: $($proc.ExitCode)"

if ($proc.ExitCode -eq 0) {
  Write-Host "Done."
} else {
  Write-Host "Installer reported an error."
}
