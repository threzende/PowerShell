$serverList = Get-Content -Path "C:\temp\thsfz\serverz.txt"
$logFilePath = "C:\temp\thsfz\dellNWlogz.txt"

foreach ($server in $serverList) {
    try {
        $session = New-PSSession -ComputerName $server
        Invoke-Command -Session $session -ScriptBlock {
            $app = Get-CimInstance -ClassName Win32_Product | Where-Object { $_.Name -eq "NetWorker" }
            if ($app) {
                $app | Invoke-CimMethod -MethodName Uninstall
                Write-Output "Sucesso: Desinstalação do NetWorker concluída no servidor $server."
            } else {
                Write-Output "Erro: NetWorker não encontrado no servidor $server."
            }
        } -ErrorAction Stop
        Remove-PSSession -Session $session
        
        if ($app) {
            Add-Content -Path $logFilePath -Value "Sucesso: Desinstalação do NetWorker concluída no servidor $server."
        } else {
            Add-Content -Path $logFilePath -Value "Erro: NetWorker não encontrado no servidor $server."
        }
    } catch {
        $status = "Erro: Falha ao desinstalar o NetWorker no servidor $server. Detalhes do erro: $_"
        Write-Output $status
        Add-Content -Path $logFilePath -Value $status
    }
}
