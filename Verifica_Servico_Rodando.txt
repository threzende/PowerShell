@echo off
setlocal enabledelayedexpansion

REM Caminho para o arquivo com a lista de servidores
set "servidoresPath=C:\caminho\para\servidores.txt"

REM Nome do serviço a ser verificado
set "nomeServico=xagt"

REM Verificar se o arquivo existe
if not exist "%servidoresPath%" (
    echo Arquivo de servidores nao encontrado em %servidoresPath%
    exit /b 1
)

REM Ler a lista de servidores e verificar o status do serviço
for /f "tokens=*" %%s in (%servidoresPath%) do (
    echo Verificando servidor: %%s
    REM Verificar se o servidor esta acessivel
    ping -n 1 %%s >nul 2>&1
    if errorlevel 1 (
        echo %%s: Nao foi possivel conectar ao servidor
    ) else (
        REM Verificar o status do servico
        sc \\%%s query %nomeServico% | find "RUNNING" >nul
        if errorlevel 0 (
            echo %%s: %nomeServico% esta Running
        ) else (
            echo %%s: %nomeServico% NAO esta Running
        )
    )
)

endlocal
