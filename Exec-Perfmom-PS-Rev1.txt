$servers = Get-Content -Path "C:\temp\thsfz\serverz.txt"
foreach ($server in $servers) {
    $counterPath = "\\$server\Processor(_Total)\% Processor Time"
    Start-Process "perfmon.exe" "/res"
    Add-Counter -Counter $counterPath
}



$servers = Get-Content -Path "C:\temp\thsfz\serverz.txt"
foreach ($server in $servers) {
    $counterPath = "\\$server\Memory\Available MBytes"
    Start-Process "perfmon.exe" "/res"
    Add-Counter -Counter $counterPath
}



$servers = Get-Content -Path "C:\temp\thsfz\serverz.txt"

# Abrir Performance Monitor para CPU
Start-Process "perfmon.exe"

# Aguardar alguns segundos para garantir que o Perfmon esteja totalmente carregado
Start-Sleep -Seconds 5

foreach ($server in $servers) {
    $cpuCounterPath = "\\$server\Processor(_Total)\% Processor Time"
    # Adicionar contador de CPU
    Add-Counter -Counter $cpuCounterPath
}
