# Caminho base do relatório
$basePath = "\\serv01\temp\report"
$baseFileName = "sccm"
$fileExtension = ".txt"

# Função para gerar um nome de arquivo único
function Get-UniqueFilePath {
    param (
        [string]$basePath,
        [string]$baseFileName,
        [string]$fileExtension
    )
    
    $counter = 1
    do {
        $fileName = "$basePath\$baseFileName$('{0:D2}' -f $counter)$fileExtension"
        $counter++
    } while (Test-Path $fileName)
    return $fileName
}

# Gerar o caminho do relatório com nome único
$reportPath = Get-UniqueFilePath -basePath $basePath -baseFileName $baseFileName -fileExtension $fileExtension

# Verificar a versão do Microsoft Edge
$edgeVersion = (Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Edge\BLBeacon" -ErrorAction SilentlyContinue).version
if (-not $edgeVersion) {
    $edgeVersion = "Microsoft Edge não está instalado"
}

# Verificar se a KB 5046616 está instalada
$kb = Get-HotFix -Id KB5046616 -ErrorAction SilentlyContinue
if ($kb) {
    $kbStatus = "KB5046616 está instalada. Data: $($kb.InstalledOn)"
} else {
    $kbStatus = "KB5046616 NÃO está instalada."
}

# Criar o relatório
$reportContent = @"
Relatório de Atualizações e Versões
===================================
Servidor: $($env:COMPUTERNAME)

KB 5046616:
$kbStatus

Versão do Microsoft Edge:
$edgeVersion
===================================
"@

# Salvar o relatório
try {
    $reportContent | Out-File -FilePath $reportPath -Encoding UTF8 -Force
    Write-Output "Relatório salvo com sucesso em: $reportPath"
} catch {
    Write-Output "Erro ao salvar o relatório: $($_.Exception.Message)"
}
